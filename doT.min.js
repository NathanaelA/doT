// doT.js
// 2011, Laura Doktorova, https://github.com/olado/doT
//
// doT.js is an open source component of http://bebedo.com
// Licensed under the MIT license.
//
(function(){function encodeHTMLSource(){var a={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},b=/&(?!#?\w+;)|<|>|"|'|\//g;return function(c){return c?c.toString().replace(b,function(b){return a[b]||b}):c}}function unescape(a){return a.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}function resolveDefs(c,block,def){return(typeof block=="string"?block:block.toString()).replace(c.define||skip,function(m,code,assign,value){return code.indexOf("def.")===0&&(code=code.substring(4)),code in def||(assign===":"?def[code]=value:eval("def['"+code+"']="+value)),""}).replace(c.use||skip,function(m,code){var v=eval(code);return v?resolveDefs(c,v,def):v})}"use strict";var startend={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},doT={version:"0.2.0",templateSettings:{use:/\{\{#([\s\S]+?)\}\}/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,varname:"it",strip:!0,"with":!0,dynamicList:"it._dynamic",startend:startend.append},startend:startend,tags:{},template:undefined,compile:undefined,getCached:undefined,setCached:undefined,addCached:undefined,render:undefined,autoload:undefined,autoloadDOM:undefined,autoloadFS:undefined},cache={},sid=0,skip=/$^/,tags=doT.tags;tags.interpolate={regex:/\{\{=([\s\S]+?)\}\}/g,func:function(a,b){var c=doT.templateSettings.startend;return c.start+unescape(b)+c.end}},tags.encode={regex:/\{\{!([\s\S]+?)\}\}/g,func:function(a,b){var c=doT.templateSettings.startend;return c.startencode+unescape(b)+c.end}},tags.conditional={regex:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,func:function(a,b,c){return b?c?"';}else if("+unescape(c)+"){out+='":"';}else{out+='":c?"';if("+unescape(c)+"){out+='":"';}out+='"}},tags.iterate={regex:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,func:function(a,b,c,d){if(!b)return"';} } out+='";sid+=1;var e=d||"i"+sid,b=unescape(b);return"';var arr"+sid+"="+b+";"+"if(arr"+sid+"){var "+c+","+e+"=-1,l"+sid+"=arr"+sid+".length-1;"+"while("+e+"<l"+sid+"){"+c+"=arr"+sid+"["+e+"+=1];out+='"}},tags.iterateFor={regex:/\{\{:\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,func:function(a,b,c,d){if(!b)return"';} } out+='";sid+=1;var e="iter"+sid;return"';var "+e+"="+b+";"+"if("+e+"){var "+c+","+d+";"+"for("+d+" in "+e+"){"+c+"="+e+"["+d+"];out+='"}},tags.includeDynamic={regex:/\{\{@@([\S]+?)\([\s]*([\s\S]*?)[\s]*\)\}\}/g,func:function(a,b,c){return"';var tmpl="+doT.templateSettings.dynamicList+"['"+unescape(b)+"'];"+"out+=doT.render({name:tmpl.name, args:tmpl.args || arguments})+'"}},tags.render={regex:/\{\{@([\S]+?)\([\s]*([\s\S]*?)[\s]*\)\}\}/g,func:function(a,b,c){return"'+doT.render('"+b+"'"+(c?","+unescape(c):"")+")+'"}},tags.evaluate={regex:/\{\{([\s\S]+?)\}\}/g,func:function(a,b){return"';"+unescape(b)+";out+='"}};var global=function(){return this||(0,eval)("this")}();typeof module!="undefined"&&module.exports?module.exports=doT:typeof define=="function"&&define.amd?define(function(){return doT}):global.doT=doT,global.encodeHTML=encodeHTMLSource(),doT.template=function(a,b){var c=doT.templateSettings,d;if(c.use||c.define){var e=global.def;global.def=b||{},d=resolveDefs(c,a,global.def),global.def=e}else d=a;d=(c.strip?d.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):d).replace(/'|\\/g,"\\$&");for(var f in doT.tags)d=d.replace(doT.tags[f].regex,doT.tags[f].func);d=("var out='"+d+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|}|^|{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|}|^|{)out\+=''\+/g,"$1out+="),c.with&&(d="with("+(!0===c.with?c.varname:c.with)+"){"+d+"}");try{return new Function(c.varname,d)}catch(g){throw g+" in "+d}},doT.compile=doT.template,doT.getCached=function(){return cache},doT.exportCached=function(){var a="";for(var b in cache)a+=',"'+b+'":'+cache[b].toString();return"{"+a.substring(1)+"}"},doT.setCached=function(a){cache=a},doT.addCached=function(a,b){if("object"==typeof a){for(i in a)doT.addCached(i,a[i]);return}cache[a]=b},doT.render=function(a){"object"!=typeof a&&(a={name:a});if(!cache[a.name]){var b=doT.autoload(a.name);if(!1===b)throw"Template not found: "+a.name;doT.addCached(a.name,doT.compile(b))}return cache[a.name].apply(this,a.args||Array.prototype.slice.call(arguments,1))},doT.autoloadDOM=function(a){return function(a){var b=document.getElementById(a);return!b||!b.type||"text/x-dot-tmpl"!=b.type?!1:b.innerHTML}},doT.autoloadFS=function(a){return function(b){try{return a.fs.readFileSync(a.root+"/"+b.replace(".","/")+".tmpl")}catch(c){return!1}}},doT.autoload=doT.autoloadDOM()})();